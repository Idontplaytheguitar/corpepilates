(()=>{var e={};e.id=455,e.ids=[455],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},6005:e=>{"use strict";e.exports=require("node:crypto")},6463:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>n.a,__next_app__:()=>u,originalPathname:()=>m,pages:()=>d,routeModule:()=>x,tree:()=>c}),s(2124),s(8622),s(5866);var r=s(3191),a=s(8716),i=s(7922),n=s.n(i),l=s(5231),o={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);s.d(t,o);let c=["",{children:["checkout",{children:["turnos",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,2124)),"C:\\Users\\agusk\\Desktop\\Stuff\\Projects\\PilatesReformer\\src\\app\\checkout\\turnos\\page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,8622)),"C:\\Users\\agusk\\Desktop\\Stuff\\Projects\\PilatesReformer\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,5866,23)),"next/dist/client/components/not-found-error"]}],d=["C:\\Users\\agusk\\Desktop\\Stuff\\Projects\\PilatesReformer\\src\\app\\checkout\\turnos\\page.tsx"],m="/checkout/turnos/page",u={require:s,loadChunk:()=>Promise.resolve()},x=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/checkout/turnos/page",pathname:"/checkout/turnos",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},4531:(e,t,s)=>{Promise.resolve().then(s.bind(s,9854))},1890:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});let r=(0,s(2881).Z)("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]])},9183:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});let r=(0,s(2881).Z)("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]])},7506:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});let r=(0,s(2881).Z)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},5562:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});let r=(0,s(2881).Z)("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]])},9854:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>j});var r=s(326),a=s(7577),i=s(5047),n=s(7506),l=s(5562),o=s(7358),c=s(1890),d=s(9183),m=s(8998),u=s(4565),x=s(8916),h=s(52),p=s(3232);let g=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],f=["Lun","Mar","Mi\xe9","Jue","Vie","S\xe1b","Dom"];function j(){let e=(0,i.useRouter)(),{clearCart:t}=(0,p.j)(),[s,j]=(0,a.useState)(null),[b,v]=(0,a.useState)(null),[N,y]=(0,a.useState)([]),[w,k]=(0,a.useState)([]),[S,P]=(0,a.useState)(0),[D,q]=(0,a.useState)(0),[I,Z]=(0,a.useState)([]),[C,M]=(0,a.useState)(new Date),[_,T]=(0,a.useState)(""),[F,O]=(0,a.useState)([]),[R,A]=(0,a.useState)(!1),[E,J]=(0,a.useState)(!1),[$,G]=(0,a.useState)(""),L=()=>s?s.serviceItems.reduce((e,t)=>e+t.quantity,0):0,U=()=>{if(!s)return null;let e=0;for(let t of s.serviceItems)for(let s=0;s<t.quantity;s++){if(e===S+D)return t;e++}return s.serviceItems[0]||null},Y=e=>{let t=e.getDay(),s=0===t?6:t-1,r=e.toISOString().split("T")[0],a=w.find(e=>e.date===r);return(!a||!a.isBlocked)&&N.some(e=>e.dayOfWeek===s&&e.slots.length>0)},z=e=>{let t=U();if(!t||!_)return;let s={serviceId:t.id,serviceIndex:I.filter(e=>e.serviceId===t.id).length,date:_,time:e,durationMinutes:t.durationMinutes};Z([...I,s]),T(""),O([])},V=e=>{Z(I.filter((t,s)=>s!==e))},B=async()=>{if(!(!s||I.length<L())){J(!0),G("");try{let e=await fetch("/api/checkout",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:s.items,serviceItems:s.serviceItems.map(e=>({...e,selectedSlots:I.filter(t=>t.serviceId===e.id).map(e=>({date:e.date,time:e.time}))})),customer:s.customer})}),r=await e.json();r.init_point?(localStorage.setItem("pendingOrder",JSON.stringify({items:s.items,serviceItems:s.serviceItems,selectedSlots:I,customer:s.customer,total:H()})),t(),window.location.href=r.init_point):G("Error al procesar el pago")}catch(e){console.error(e),G("Error de conexi\xf3n")}finally{J(!1)}}},H=()=>s?s.items.reduce((e,t)=>e+t.price*t.quantity,0)+s.serviceItems.reduce((e,t)=>e+t.price*t.quantity,0):0,W=e=>new Date(e+"T12:00:00").toLocaleDateString("es-AR",{weekday:"short",day:"numeric",month:"short"});if(!s)return r.jsx("div",{className:"min-h-screen bg-cream-50 flex items-center justify-center",children:r.jsx(n.Z,{className:"w-8 h-8 animate-spin text-rose-500"})});let X=L(),K=I.length>=X;return r.jsx("div",{className:"min-h-screen bg-cream-50 pt-24 pb-12",children:(0,r.jsxs)("div",{className:"max-w-4xl mx-auto px-4",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[r.jsx("h1",{className:"font-display text-3xl font-semibold text-rose-800",children:"Seleccionar Turnos"}),r.jsx("button",{onClick:()=>{confirm("\xbfSeguro que quer\xe9s cancelar? Volver\xe1s al inicio.")&&(localStorage.removeItem("checkoutData"),e.push("/"))},className:"text-sm text-nude-500 hover:text-rose-600 transition-colors",children:"Cancelar"})]}),r.jsx("p",{className:"text-nude-600 mb-6",children:"Eleg\xed fecha y hora para cada servicio"}),b?.location&&(0,r.jsxs)("div",{className:"flex items-center gap-2 text-sage-700 bg-sage-50 px-4 py-2 rounded-lg mb-6 text-sm",children:[r.jsx(l.Z,{className:"w-4 h-4"}),r.jsx("span",{children:b.location})]}),r.jsx("div",{className:"flex gap-1.5 mb-6",children:Array.from({length:X}).map((e,t)=>r.jsx("div",{className:`h-2 flex-1 rounded-full transition-colors ${t<I.length?"bg-rose-500":"bg-cream-200"}`},t))}),(0,r.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm border border-cream-100 p-6",children:[(0,r.jsxs)("h2",{className:"font-display text-xl font-semibold text-rose-800 mb-4 flex items-center gap-2",children:[r.jsx(o.Z,{className:"w-5 h-5"}),K?"Turnos seleccionados":(()=>{if(!s)return"";let e=0;for(let t of s.serviceItems)for(let s=0;s<t.quantity;s++){if(e===I.length){if(t.quantity>1)return`${t.name} (${s+1}/${t.quantity})`;return t.name}e++}return""})()]}),K?r.jsx("div",{className:"space-y-2",children:I.map((e,t)=>{let a=s.serviceItems.find(t=>t.id===e.serviceId);return(0,r.jsxs)("div",{className:"flex items-center justify-between p-3 bg-sage-50 rounded-lg",children:[(0,r.jsxs)("div",{children:[r.jsx("p",{className:"font-medium text-sage-800",children:a?.name}),(0,r.jsxs)("p",{className:"text-sm text-sage-600",children:[W(e.date)," â€¢ ",e.time]})]}),r.jsx("button",{onClick:()=>V(t),className:"text-rose-500 hover:text-rose-700 text-sm",children:"Cambiar"})]},t)})}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("button",{onClick:()=>M(new Date(C.getFullYear(),C.getMonth()-1)),className:"p-2 hover:bg-cream-100 rounded-lg transition-colors",children:r.jsx(c.Z,{className:"w-5 h-5 text-rose-600"})}),(0,r.jsxs)("span",{className:"font-semibold text-rose-800",children:[g[C.getMonth()]," ",C.getFullYear()]}),r.jsx("button",{onClick:()=>M(new Date(C.getFullYear(),C.getMonth()+1)),className:"p-2 hover:bg-cream-100 rounded-lg transition-colors",children:r.jsx(d.Z,{className:"w-5 h-5 text-rose-600"})})]}),r.jsx("div",{className:"grid grid-cols-7 gap-1 text-center text-xs mb-2",children:f.map(e=>r.jsx("div",{className:"py-1 text-nude-500 font-medium",children:e},e))}),r.jsx("div",{className:"grid grid-cols-7 gap-1",children:(()=>{let e=C.getFullYear(),t=C.getMonth(),s=new Date(e,t,1),r=new Date(e,t+1,0),a=[],i=(s.getDay()+6)%7;for(let e=0;e<i;e++)a.push(null);for(let s=1;s<=r.getDate();s++)a.push(new Date(e,t,s));return a})().map((e,t)=>{if(!e)return r.jsx("div",{},t);let s=e.toISOString().split("T")[0],a=_===s,i=!(e<new Date(new Date().setHours(0,0,0,0)))&&Y(e),n=new Date().toDateString()===e.toDateString();return r.jsx("button",{onClick:()=>i&&T(s),disabled:!i,className:`py-2 rounded-lg text-sm font-medium transition-all ${a?"bg-rose-500 text-white shadow-md":i?n?"bg-sage-100 text-sage-700 hover:bg-sage-200":"hover:bg-rose-100 text-rose-800":"text-nude-300 cursor-not-allowed"}`,children:e.getDate()},t)})})]}),_&&(0,r.jsxs)("div",{children:[(0,r.jsxs)("h3",{className:"font-medium text-rose-700 mb-3 flex items-center gap-2",children:[r.jsx(m.Z,{className:"w-4 h-4"}),W(_)]}),R?r.jsx("div",{className:"flex items-center justify-center py-8",children:r.jsx(n.Z,{className:"w-6 h-6 animate-spin text-rose-500"})}):0===F.length?r.jsx("p",{className:"text-nude-500 text-center py-4",children:"No hay horarios disponibles"}):r.jsx("div",{className:"grid grid-cols-3 gap-2 max-h-48 overflow-y-auto",children:F.map(e=>r.jsx("button",{onClick:()=>z(e),className:"px-3 py-2 text-sm rounded-lg border border-cream-200 hover:border-rose-400 hover:bg-rose-50 text-rose-800 transition-all",children:e},e))})]})]})]}),(0,r.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm border border-cream-100 p-6",children:[(0,r.jsxs)("h2",{className:"font-display text-xl font-semibold text-rose-800 mb-4 flex items-center gap-2",children:[r.jsx(u.Z,{className:"w-5 h-5"}),"Resumen"]}),(0,r.jsxs)("div",{className:"space-y-4",children:[s.items.length>0&&(0,r.jsxs)("div",{className:"space-y-2",children:[r.jsx("h3",{className:"text-sm font-medium text-nude-500 uppercase tracking-wide",children:"Productos"}),s.items.map(e=>(0,r.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,r.jsxs)("span",{className:"text-rose-800",children:[e.name," x",e.quantity]}),r.jsx("span",{className:"text-rose-600 font-medium",children:(0,h.T4)(e.price*e.quantity)})]},e.id))]}),s.serviceItems.length>0&&(0,r.jsxs)("div",{className:"space-y-2",children:[r.jsx("h3",{className:"text-sm font-medium text-nude-500 uppercase tracking-wide",children:"Servicios"}),s.serviceItems.map(e=>(0,r.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,r.jsxs)("span",{className:"text-sage-800",children:[e.name," x",e.quantity]}),r.jsx("span",{className:"text-sage-600 font-medium",children:(0,h.T4)(e.price*e.quantity)})]},e.id))]}),r.jsx("div",{className:"border-t border-cream-200 pt-4",children:(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[r.jsx("span",{className:"font-medium text-rose-700",children:"Total"}),r.jsx("span",{className:"text-2xl font-display font-semibold text-rose-800",children:(0,h.T4)(H())})]})}),(0,r.jsxs)("div",{className:"pt-4",children:[r.jsx("p",{className:"text-sm text-nude-500 mb-2",children:"Datos del cliente"}),(0,r.jsxs)("div",{className:"text-sm text-nude-700",children:[r.jsx("p",{children:s.customer.name}),r.jsx("p",{children:s.customer.email}),r.jsx("p",{children:s.customer.phone})]})]}),$&&r.jsx("p",{className:"text-rose-500 text-sm text-center",children:$}),r.jsx("button",{onClick:B,disabled:!K||E,className:"w-full py-4 bg-gradient-to-r from-rose-500 to-rose-600 text-white rounded-xl font-semibold hover:from-rose-600 hover:to-rose-700 transition-all flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:E?(0,r.jsxs)(r.Fragment,{children:[r.jsx(n.Z,{className:"w-5 h-5 animate-spin"}),"Procesando..."]}):K?(0,r.jsxs)(r.Fragment,{children:[r.jsx(x.Z,{className:"w-5 h-5"}),"Pagar con MercadoPago"]}):(0,r.jsxs)(r.Fragment,{children:[r.jsx(o.Z,{className:"w-5 h-5"}),"Seleccion\xe1 ",X-I.length," turno",X-I.length!=1?"s":""," m\xe1s"]})}),!K&&(0,r.jsxs)("p",{className:"text-center text-xs text-nude-500",children:[I.length,"/",X," turnos seleccionados"]})]})]})]})]})})}},2124:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>r});let r=(0,s(8570).createProxy)(String.raw`C:\Users\agusk\Desktop\Stuff\Projects\PilatesReformer\src\app\checkout\turnos\page.tsx#default`)}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[276,779,454,66],()=>s(6463));module.exports=r})();