(()=>{var e={};e.id=451,e.ids=[451],e.modules={20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},78893:e=>{"use strict";e.exports=require("buffer")},61282:e=>{"use strict";e.exports=require("child_process")},84770:e=>{"use strict";e.exports=require("crypto")},80665:e=>{"use strict";e.exports=require("dns")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},35240:e=>{"use strict";e.exports=require("https")},98216:e=>{"use strict";e.exports=require("net")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},76162:e=>{"use strict";e.exports=require("stream")},74026:e=>{"use strict";e.exports=require("string_decoder")},82452:e=>{"use strict";e.exports=require("tls")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},87529:()=>{},43609:(e,r,t)=>{"use strict";t.r(r),t.d(r,{originalPathname:()=>h,patchFetch:()=>v,requestAsyncStorage:()=>f,routeModule:()=>m,serverHooks:()=>x,staticGenerationAsyncStorage:()=>g});var s={};t.r(s),t.d(s,{GET:()=>d,POST:()=>l});var a=t(49303),i=t(88716),o=t(60670),n=t(87070),c=t(66299),u=t(58867),p=t(20471);async function l(e){try{let{reservationId:r,paymentId:t}=await e.json();if(!r)return n.NextResponse.json({error:"ID de reserva requerido"},{status:400});let s=await (0,c.Qv)(r);if(!s)return n.NextResponse.json({error:"Reserva no encontrada"},{status:404});s.status="confirmed",t&&(s.paymentId=t),await (0,c.iD)(s);let a=await (0,c.QN)(),i=new Date(s.date+"T12:00:00").toLocaleDateString("es-AR",{weekday:"long",day:"numeric",month:"long",year:"numeric"}),o=a.site.location?`<p><strong>ğŸ“ Ubicaci\xf3n:</strong> ${a.site.location}</p>`:"",l=`
      <div style="font-family: sans-serif; max-width: 600px; margin: 0 auto;">
        <h2 style="color: #be185d;">ğŸ‰ Nueva Reserva Confirmada</h2>
        <div style="background: #fdf2f8; padding: 20px; border-radius: 12px; margin: 20px 0;">
          <h3 style="color: #9f1239; margin-top: 0;">${s.serviceName}</h3>
          <p><strong>ğŸ“… Fecha:</strong> ${i}</p>
          <p><strong>ğŸ• Horario:</strong> ${s.time} - ${s.endTime}</p>
          <p><strong>ğŸ’° Precio:</strong> ${(0,u.T4)(s.servicePrice)}</p>
          ${o}
        </div>
        <div style="background: #f1f5f9; padding: 20px; border-radius: 12px;">
          <h4 style="margin-top: 0;">Datos del cliente:</h4>
          <p><strong>ğŸ‘¤ Nombre:</strong> ${s.customerName}</p>
          <p><strong>ğŸ“§ Email:</strong> ${s.customerEmail}</p>
          <p><strong>ğŸ“± Tel\xe9fono:</strong> ${s.customerPhone}</p>
        </div>
      </div>
    `,d=`
      <div style="font-family: sans-serif; max-width: 600px; margin: 0 auto;">
        <h2 style="color: #be185d;">âœ… Reserva Confirmada</h2>
        <p>\xa1Hola ${s.customerName}!</p>
        <p>Tu reserva ha sido confirmada. Te esperamos:</p>
        <div style="background: #fdf2f8; padding: 20px; border-radius: 12px; margin: 20px 0;">
          <h3 style="color: #9f1239; margin-top: 0;">${s.serviceName}</h3>
          <p><strong>ğŸ“… Fecha:</strong> ${i}</p>
          <p><strong>ğŸ• Horario:</strong> ${s.time}hs</p>
          ${o}
        </div>
        <p style="color: #64748b; font-size: 14px;">
          Si necesit\xe1s cancelar o reprogramar tu turno, contactanos por WhatsApp al ${a.site.whatsapp}.
        </p>
        <p style="margin-top: 30px;">\xa1Nos vemos pronto! ğŸ’•</p>
        <p><strong>${a.site.siteName}</strong></p>
      </div>
    `;return a.site.email&&await (0,p.C)(a.site.email,`Nueva reserva: ${s.serviceName} - ${i}`,l),await (0,p.C)(s.customerEmail,`Tu reserva est\xe1 confirmada - ${a.site.siteName}`,d),n.NextResponse.json({success:!0,reservation:s})}catch(e){return console.error("Error confirming reservation:",e),n.NextResponse.json({error:"Error al confirmar la reserva"},{status:500})}}async function d(e){try{let{searchParams:r}=new URL(e.url),t=r.get("id");if(!t)return n.NextResponse.json({error:"ID de reserva requerido"},{status:400});let s=await (0,c.Qv)(t);if(!s)return n.NextResponse.json({error:"Reserva no encontrada"},{status:404});return n.NextResponse.json({reservation:s})}catch(e){return console.error("Error getting reservation:",e),n.NextResponse.json({error:"Error al obtener la reserva"},{status:500})}}let m=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/booking/confirm/route",pathname:"/api/booking/confirm",filename:"route",bundlePath:"app/api/booking/confirm/route"},resolvedPagePath:"C:\\Users\\agusk\\Desktop\\Stuff\\Projects\\PilatesReformer\\src\\app\\api\\booking\\confirm\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:f,staticGenerationAsyncStorage:g,serverHooks:x}=m,h="/api/booking/confirm/route";function v(){return(0,o.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:g})}},58867:(e,r,t)=>{"use strict";t.d(r,{T4:()=>a,TD:()=>i,mH:()=>n,mr:()=>o,u_:()=>s});let s={site:{siteName:"Corpe Pilates",tagline:"Pilates Reformer para todos",instagram:"https://instagram.com/corpepilates",whatsapp:"5491161515110",email:"corpepilates@gmail.com",location:"Avenida Segurola 386, Floresta, CABA",deliveryMode:"pickup",productsEnabled:!1},booking:{enabled:!0,recurring:[{dayOfWeek:2,slots:[{start:"18:00",end:"19:00"}]},{dayOfWeek:5,slots:[{start:"18:00",end:"19:00"}]}],exceptions:[]},products:[],services:[{id:"plan-1x",name:"Plan 1x Semana",description:"4 clases mensuales de Pilates Reformer. Ideal para iniciarte en la pr\xe1ctica y trabajar tu core, postura y fuerza general.",price:25e3,duration:"60 min",durationMinutes:60,image:"https://images.unsplash.com/photo-1518611012118-696072aa579a?w=400&h=400&fit=crop"},{id:"plan-2x",name:"Plan 2x Semana",description:"8 clases mensuales de Pilates Reformer. Perfecto para progresar m\xe1s r\xe1pido y sentir resultados en pocas semanas.",price:4e4,duration:"60 min",durationMinutes:60,image:"https://images.unsplash.com/photo-1571019614242-c5c5dee9f50b?w=400&h=400&fit=crop"},{id:"plan-3x",name:"Plan 3x Semana",description:"12 clases mensuales de Pilates Reformer. M\xe1ximos resultados: mayor fuerza, flexibilidad y cuidado de tu columna.",price:55e3,duration:"60 min",durationMinutes:60,image:"https://images.unsplash.com/photo-1599901860904-17e6ed7083a0?w=400&h=400&fit=crop"}]};function a(e){return new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS",minimumFractionDigits:0,maximumFractionDigits:0}).format(e)}function i(e){let[r,t]=e.split(":").map(Number);return 60*r+t}function o(e){return`${Math.floor(e/60).toString().padStart(2,"0")}:${(e%60).toString().padStart(2,"0")}`}function n(e,r){return o(i(e)+r)}},20471:(e,r,t)=>{"use strict";t.d(r,{C:()=>i});var s=t(55245),a=t(66299);async function i(e,r,t){let i=process.env.SMTP_USER,o=process.env.SMTP_PASS,n=process.env.SMTP_HOST||"smtp.gmail.com",c=parseInt(process.env.SMTP_PORT||"465");if(!i||!o)return console.log("SMTP not configured, skipping email to:",e),{success:!1,error:"Email no configurado en el servidor"};try{let u=await (0,a.QN)(),p=u.site?.siteName||"Corpe Pilates",l=s.createTransport({host:n,port:c,secure:465===c,auth:{user:i,pass:o}});return await l.sendMail({from:`${p} <${i}>`,to:e,subject:r,html:t}),{success:!0}}catch(e){return console.error("Error sending email:",e),{success:!1,error:e instanceof Error?e.message:"Error desconocido"}}}},79534:(e,r,t)=>{"use strict";t.d(r,{Q:()=>o});var s=t(62197),a=t.n(s);let i=null;function o(){if(!i){let e=process.env.REDIS_URL;if(!e)throw Error("Missing REDIS_URL environment variable");i=new(a())(e)}return i}},66299:(e,r,t)=>{"use strict";t.d(r,{AU:()=>f,HG:()=>x,IF:()=>p,Oh:()=>u,QN:()=>c,Qv:()=>m,TR:()=>g,iD:()=>l,pF:()=>d});var s=t(58867),a=t(79534);let i="corpepilates:config",o="corpepilates:reservations",n="corpepilates:orders";async function c(){try{let e=(0,a.Q)(),r=await e.get(i);if(r)return JSON.parse(r);return s.u_}catch(e){return console.error("Error getting config:",e),s.u_}}async function u(e){try{let r=(0,a.Q)();return await r.set(i,JSON.stringify(e)),!0}catch(e){return console.error("Error saving config:",e),!1}}async function p(){try{let e=(0,a.Q)(),r=await e.get(o);if(r)return JSON.parse(r);return[]}catch{return[]}}async function l(e){try{let r=(0,a.Q)(),t=await p(),s=t.findIndex(r=>r.id===e.id);return s>=0?t[s]=e:t.push(e),await r.set(o,JSON.stringify(t)),!0}catch(e){return console.error("Error saving reservation:",e),!1}}async function d(e){return(await p()).filter(r=>r.date===e&&"cancelled"!==r.status)}async function m(e){return(await p()).find(r=>r.id===e)||null}async function f(){try{let e=(0,a.Q)(),r=await e.get(n);if(r)return JSON.parse(r);return[]}catch{return[]}}async function g(e){try{let r=(0,a.Q)(),t=await f(),s=t.findIndex(r=>r.id===e.id);return s>=0?t[s]=e:t.push(e),await r.set(n,JSON.stringify(t)),!0}catch(e){return console.error("Error saving order:",e),!1}}async function x(e){return(await f()).find(r=>r.id===e)||null}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[276,197,59,245],()=>t(43609));module.exports=s})();