(()=>{var e={};e.id=958,e.ids=[958],e.modules={20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},78893:e=>{"use strict";e.exports=require("buffer")},84770:e=>{"use strict";e.exports=require("crypto")},80665:e=>{"use strict";e.exports=require("dns")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},35240:e=>{"use strict";e.exports=require("https")},98216:e=>{"use strict";e.exports=require("net")},55315:e=>{"use strict";e.exports=require("path")},68621:e=>{"use strict";e.exports=require("punycode")},76162:e=>{"use strict";e.exports=require("stream")},74026:e=>{"use strict";e.exports=require("string_decoder")},82452:e=>{"use strict";e.exports=require("tls")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},87529:()=>{},57928:(e,t,r)=>{"use strict";r.r(t),r.d(t,{originalPathname:()=>w,patchFetch:()=>x,requestAsyncStorage:()=>g,routeModule:()=>m,serverHooks:()=>h,staticGenerationAsyncStorage:()=>y});var a={};r.r(a),r.d(a,{POST:()=>f});var n=r(49303),i=r(88716),s=r(60670),o=r(87070),c=r(36994),u=r(66299),l=r(90214),p=r(95579),d=r(58867);async function f(e){try{let{serviceId:t,date:r,time:a,customer:n}=await e.json();if(!t||!r||!a||!n?.name||!n?.email||!n?.phone)return o.NextResponse.json({error:"Faltan datos requeridos"},{status:400});let i=await (0,u.QN)();if(!i.booking?.enabled)return o.NextResponse.json({error:"Las reservas no est\xe1n habilitadas"},{status:400});let s=i.services.find(e=>e.id===t);if(!s)return o.NextResponse.json({error:"Servicio no encontrado"},{status:400});let f=(0,d.mH)(a,s.durationMinutes||60);if((await (0,u.pF)(r)).some(e=>"cancelled"!==e.status&&e.time===a))return o.NextResponse.json({error:"Este horario ya fue reservado"},{status:400});let m=`res_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,g={id:m,serviceId:s.id,serviceName:s.name,servicePrice:s.price,date:r,time:a,endTime:f,customerName:n.name,customerEmail:n.email,customerPhone:n.phone,status:"pending",createdAt:Date.now()};await (0,u.iD)(g);let y=await (0,l.VX)()?await (0,l.Bv)():null;if(!y)return o.NextResponse.json({error:"No hay cuenta de MercadoPago conectada. Contacta al vendedor."},{status:400});let h=new c.f7({accessToken:y}),w=function(){let e="https://corpepilates.vercel.app/";return e.endsWith("/")?e.slice(0,-1):e}(),x=new c.Jk(h),v=await (0,p.eA)(),_=v.enabled?Math.round(s.price*(v.percentage/100)):0,S=new Date(r+"T12:00:00").toLocaleDateString("es-AR",{weekday:"long",day:"numeric",month:"long"}),b=await x.create({body:{items:[{id:s.id,title:`Reserva: ${s.name}`,description:`${S} a las ${a}hs`,quantity:1,unit_price:s.price,currency_id:"ARS",picture_url:s.image}],payer:{name:n.name,email:n.email,phone:{number:n.phone}},back_urls:{success:`${w}/reserva/confirmada?id=${m}`,failure:`${w}/reserva/fallida?id=${m}`,pending:`${w}/reserva/pendiente?id=${m}`},auto_return:"approved",statement_descriptor:"CORPEPILATES",external_reference:m,..._>0&&{marketplace_fee:_},expires:!0,expiration_date_from:new Date().toISOString(),expiration_date_to:new Date(Date.now()+18e5).toISOString()}});return o.NextResponse.json({reservationId:m,init_point:b.init_point})}catch(e){return console.error("Error creating reservation:",e),o.NextResponse.json({error:"Error al crear la reserva"},{status:500})}}let m=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/booking/create/route",pathname:"/api/booking/create",filename:"route",bundlePath:"app/api/booking/create/route"},resolvedPagePath:"C:\\Users\\agusk\\Desktop\\Stuff\\Projects\\PilatesReformer\\src\\app\\api\\booking\\create\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:g,staticGenerationAsyncStorage:y,serverHooks:h}=m,w="/api/booking/create/route";function x(){return(0,s.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:y})}},58867:(e,t,r)=>{"use strict";r.d(t,{T4:()=>n,TD:()=>i,mH:()=>o,mr:()=>s,u_:()=>a});let a={site:{siteName:"Corpe Pilates",tagline:"Pilates Reformer para todos",instagram:"https://instagram.com/corpepilates",whatsapp:"5491161515110",email:"corpepilates@gmail.com",location:"Avenida Segurola 386, Floresta, CABA",deliveryMode:"pickup",productsEnabled:!1},booking:{enabled:!0,recurring:[{dayOfWeek:2,slots:[{start:"18:00",end:"19:00"}]},{dayOfWeek:5,slots:[{start:"18:00",end:"19:00"}]}],exceptions:[]},products:[],services:[{id:"plan-1x",name:"Plan 1x Semana",description:"4 clases mensuales de Pilates Reformer. Ideal para iniciarte en la pr\xe1ctica y trabajar tu core, postura y fuerza general.",price:25e3,duration:"60 min",durationMinutes:60,image:"https://images.unsplash.com/photo-1518611012118-696072aa579a?w=400&h=400&fit=crop"},{id:"plan-2x",name:"Plan 2x Semana",description:"8 clases mensuales de Pilates Reformer. Perfecto para progresar m\xe1s r\xe1pido y sentir resultados en pocas semanas.",price:4e4,duration:"60 min",durationMinutes:60,image:"https://images.unsplash.com/photo-1571019614242-c5c5dee9f50b?w=400&h=400&fit=crop"},{id:"plan-3x",name:"Plan 3x Semana",description:"12 clases mensuales de Pilates Reformer. M\xe1ximos resultados: mayor fuerza, flexibilidad y cuidado de tu columna.",price:55e3,duration:"60 min",durationMinutes:60,image:"https://images.unsplash.com/photo-1599901860904-17e6ed7083a0?w=400&h=400&fit=crop"}]};function n(e){return new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS",minimumFractionDigits:0,maximumFractionDigits:0}).format(e)}function i(e){let[t,r]=e.split(":").map(Number);return 60*t+r}function s(e){return`${Math.floor(e/60).toString().padStart(2,"0")}:${(e%60).toString().padStart(2,"0")}`}function o(e,t){return s(i(e)+t)}},95579:(e,t,r)=>{"use strict";r.d(t,{Bu:()=>p,Wc:()=>d,_d:()=>c,eA:()=>f});var a=r(79534);let n="corpepilates:fee_enabled",i="corpepilates:fee_percentage",s="corpepilates:development_paid";async function o(){try{let e=(0,a.Q)(),t=await e.get(s);return"true"===t}catch{return!1}}async function c(e){try{let t=(0,a.Q)();return await t.set(s,e?"true":"false"),e&&await t.set(n,"false"),!0}catch{return!1}}async function u(){try{if(await o())return!1;let e=(0,a.Q)(),t=await e.get(n);return"false"!==t}catch{return!0}}async function l(){try{let e=(0,a.Q)(),t=await e.get(i);return t?parseInt(t):5}catch{return 5}}async function p(e){try{let t=(0,a.Q)();return await t.set(n,e?"true":"false"),!0}catch{return!1}}async function d(e){try{let t=(0,a.Q)();return await t.set(i,e.toString()),!0}catch{return!1}}async function f(){let[e,t,r]=await Promise.all([u(),l(),o()]);return{enabled:e,percentage:t,developmentPaid:r}}},90214:(e,t,r)=>{"use strict";r.d(t,{Bv:()=>l,Db:()=>s,VX:()=>i,ih:()=>c,lP:()=>o});var a=r(79534);let n="corpepilates:seller";async function i(){try{let e=(0,a.Q)(),t=await e.get(n);if(t)return JSON.parse(t);return null}catch{return null}}async function s(e){try{let t=(0,a.Q)();return await t.set(n,JSON.stringify(e)),!0}catch(e){return console.error("Error saving seller credentials:",e),!1}}async function o(e,t=5){try{let r=await i();if(!r)return!1;r.feeEnabled=e,r.feePercentage=t;let s=(0,a.Q)();return await s.set(n,JSON.stringify(r)),!0}catch{return!1}}async function c(){try{let e=(0,a.Q)();return await e.del(n),!0}catch{return!1}}async function u(e){try{let t=await fetch("https://api.mercadopago.com/oauth/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({grant_type:"refresh_token",client_id:process.env.CLIENT_ID||"",client_secret:process.env.CLIENT_SECRET||"",refresh_token:e})});if(!t.ok)return null;let r=await t.json(),a={accessToken:r.access_token,refreshToken:r.refresh_token,userId:r.user_id.toString(),publicKey:r.public_key,expiresAt:Date.now()+1e3*r.expires_in,connectedAt:Date.now(),feeEnabled:!0,feePercentage:5};return await s(a),a}catch{return null}}async function l(){let e=await i();if(!e)return null;if(Date.now()>e.expiresAt-6e4){let t=await u(e.refreshToken);return t?.accessToken||null}return e.accessToken}},79534:(e,t,r)=>{"use strict";r.d(t,{Q:()=>s});var a=r(62197),n=r.n(a);let i=null;function s(){if(!i){let e=process.env.REDIS_URL;if(!e)throw Error("Missing REDIS_URL environment variable");i=new(n())(e)}return i}},66299:(e,t,r)=>{"use strict";r.d(t,{AU:()=>m,HG:()=>y,IF:()=>l,Oh:()=>u,QN:()=>c,Qv:()=>f,TR:()=>g,iD:()=>p,pF:()=>d});var a=r(58867),n=r(79534);let i="corpepilates:config",s="corpepilates:reservations",o="corpepilates:orders";async function c(){try{let e=(0,n.Q)(),t=await e.get(i);if(t)return JSON.parse(t);return a.u_}catch(e){return console.error("Error getting config:",e),a.u_}}async function u(e){try{let t=(0,n.Q)();return await t.set(i,JSON.stringify(e)),!0}catch(e){return console.error("Error saving config:",e),!1}}async function l(){try{let e=(0,n.Q)(),t=await e.get(s);if(t)return JSON.parse(t);return[]}catch{return[]}}async function p(e){try{let t=(0,n.Q)(),r=await l(),a=r.findIndex(t=>t.id===e.id);return a>=0?r[a]=e:r.push(e),await t.set(s,JSON.stringify(r)),!0}catch(e){return console.error("Error saving reservation:",e),!1}}async function d(e){return(await l()).filter(t=>t.date===e&&"cancelled"!==t.status)}async function f(e){return(await l()).find(t=>t.id===e)||null}async function m(){try{let e=(0,n.Q)(),t=await e.get(o);if(t)return JSON.parse(t);return[]}catch{return[]}}async function g(e){try{let t=(0,n.Q)(),r=await m(),a=r.findIndex(t=>t.id===e.id);return a>=0?r[a]=e:r.push(e),await t.set(o,JSON.stringify(r)),!0}catch(e){return console.error("Error saving order:",e),!1}}async function y(e){return(await m()).find(t=>t.id===e)||null}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[276,197,59,994],()=>r(57928));module.exports=a})();