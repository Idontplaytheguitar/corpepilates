"use strict";(()=>{var e={};e.id=418,e.ids=[418],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6005:e=>{e.exports=require("node:crypto")},7758:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>g,patchFetch:()=>h,requestAsyncStorage:()=>p,routeModule:()=>d,serverHooks:()=>f,staticGenerationAsyncStorage:()=>m});var n={};r.r(n),r.d(n,{GET:()=>c});var a=r(9303),s=r(8716),o=r(670),i=r(7070),u=r(6299),l=r(8867);async function c(e){try{let{searchParams:t}=new URL(e.url),r=t.get("date"),n=t.get("serviceId");if(!r||!n)return i.NextResponse.json({error:"Faltan par\xe1metros"},{status:400});let a=await (0,u.QN)();if(!a.booking?.enabled)return i.NextResponse.json({error:"Las reservas no est\xe1n habilitadas"},{status:400});let s=a.services.find(e=>e.id===n);if(!s)return i.NextResponse.json({error:"Servicio no encontrado"},{status:400});let o=s.durationMinutes||60,c=new Date(r+"T12:00:00").getDay(),d=a.booking.recurring?.find(e=>e.dayOfWeek===c);if(!d||0===d.slots.length)return i.NextResponse.json({slots:[],message:"No hay atenci\xf3n este d\xeda"});let p=a.booking.exceptions?.find(e=>e.date===r),m=[];if(p){if(p.isBlocked)return i.NextResponse.json({slots:[],message:"Esta fecha est\xe1 bloqueada"});m=function(e,t){if(0===t.length)return e;let r=Array(48).fill(!1);for(let t of e){let e=(0,l.TD)(t.start)/30,n=(0,l.TD)(t.end)/30;for(let t=e;t<n&&t<48;t++)r[t]=!0}for(let e of t){let t=(0,l.TD)(e.start)/30,n=(0,l.TD)(e.end)/30;for(let e=t;e<n&&e<48;e++)r[e]=!1}let n=[],a=null;for(let e=0;e<=48;e++)r[e]&&null===a?a=e:r[e]||null===a||(n.push({start:(0,l.mr)(30*a),end:(0,l.mr)(30*e)}),a=null);return n}(d.slots,p.slots)}else m=d.slots;let f=new Date;f.setHours(0,0,0,0);let g=new Date(r+"T00:00:00");if(g<f)return i.NextResponse.json({slots:[],message:"No se pueden reservar fechas pasadas"});let h=(await (0,u.pF)(r)).map(e=>({start:(0,l.TD)(e.time),end:(0,l.TD)(e.endTime||e.time)||(0,l.TD)(e.time)+60})),y=[];for(let e of m){let t=(0,l.TD)(e.start),r=(0,l.TD)(e.end),n=t;for(;n+o<=r;){let e=n+o;if(!h.some(t=>n>=t.start&&n<t.end||e>t.start&&e<=t.end||n<=t.start&&e>=t.end)){if(g.toDateString()===f.toDateString()){let e=new Date,t=60*e.getHours()+e.getMinutes();n>t+60&&y.push((0,l.mr)(n))}else y.push((0,l.mr)(n))}n+=30}}return i.NextResponse.json({slots:y,service:{id:s.id,name:s.name,price:s.price,duration:o}})}catch(e){return console.error("Error getting slots:",e),i.NextResponse.json({error:"Error al obtener disponibilidad"},{status:500})}}let d=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/booking/slots/route",pathname:"/api/booking/slots",filename:"route",bundlePath:"app/api/booking/slots/route"},resolvedPagePath:"C:\\Users\\agusk\\Desktop\\Stuff\\Projects\\PilatesReformer\\src\\app\\api\\booking\\slots\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:p,staticGenerationAsyncStorage:m,serverHooks:f}=d,g="/api/booking/slots/route";function h(){return(0,o.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:m})}},8867:(e,t,r)=>{r.d(t,{T4:()=>a,TD:()=>s,mH:()=>i,mr:()=>o,u_:()=>n});let n={site:{siteName:"Corpe Pilates",tagline:"Pilates Reformer para todos",instagram:"https://instagram.com/corpepilates",whatsapp:"5491161515110",email:"corpepilates@gmail.com",location:"Avenida Segurola 386, Floresta, CABA",deliveryMode:"pickup"},booking:{enabled:!0,recurring:[{dayOfWeek:2,slots:[{start:"18:00",end:"19:00"}]},{dayOfWeek:5,slots:[{start:"18:00",end:"19:00"}]}],exceptions:[]},products:[],services:[{id:"plan-1x",name:"Plan 1x Semana",description:"4 clases mensuales de Pilates Reformer. Ideal para iniciarte en la pr\xe1ctica y trabajar tu core, postura y fuerza general.",price:25e3,duration:"60 min",durationMinutes:60,image:"https://images.unsplash.com/photo-1518611012118-696072aa579a?w=400&h=400&fit=crop"},{id:"plan-2x",name:"Plan 2x Semana",description:"8 clases mensuales de Pilates Reformer. Perfecto para progresar m\xe1s r\xe1pido y sentir resultados en pocas semanas.",price:4e4,duration:"60 min",durationMinutes:60,image:"https://images.unsplash.com/photo-1571019614242-c5c5dee9f50b?w=400&h=400&fit=crop"},{id:"plan-3x",name:"Plan 3x Semana",description:"12 clases mensuales de Pilates Reformer. M\xe1ximos resultados: mayor fuerza, flexibilidad y cuidado de tu columna.",price:55e3,duration:"60 min",durationMinutes:60,image:"https://images.unsplash.com/photo-1599901860904-17e6ed7083a0?w=400&h=400&fit=crop"}]};function a(e){return new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS",minimumFractionDigits:0,maximumFractionDigits:0}).format(e)}function s(e){let[t,r]=e.split(":").map(Number);return 60*t+r}function o(e){return`${Math.floor(e/60).toString().padStart(2,"0")}:${(e%60).toString().padStart(2,"0")}`}function i(e,t){return o(s(e)+t)}},6299:(e,t,r)=>{r.d(t,{AU:()=>h,HG:()=>x,IF:()=>p,Oh:()=>d,QN:()=>c,Qv:()=>g,TR:()=>y,iD:()=>m,pF:()=>f});var n=r(8867),a=r(8779);let s="corpepilates:config",o="corpepilates:reservations",i="corpepilates:orders",u=null;function l(){if(u)return u;let e=process.env.KV_REST_API_URL,t=process.env.KV_REST_API_TOKEN;if(!e||!t)throw Error("Missing KV_REST_API_URL / KV_REST_API_TOKEN");return u=(0,a.eI)({url:e,token:t,cache:"no-store"})}async function c(){try{return await l().get(s)||n.u_}catch(e){return n.u_}}async function d(e){try{return await l().set(s,e),!0}catch(e){return console.error("Error saving config:",e),!1}}async function p(){try{return await l().get(o)||[]}catch{return[]}}async function m(e){try{let t=await p(),r=t.findIndex(t=>t.id===e.id);return r>=0?t[r]=e:t.push(e),await l().set(o,t),!0}catch(e){return console.error("Error saving reservation:",e),!1}}async function f(e){return(await p()).filter(t=>t.date===e&&"cancelled"!==t.status)}async function g(e){return(await p()).find(t=>t.id===e)||null}async function h(){try{return await l().get(i)||[]}catch{return[]}}async function y(e){try{let t=await h(),r=t.findIndex(t=>t.id===e.id);return r>=0?t[r]=e:t.push(e),await l().set(i,t),!0}catch(e){return console.error("Error saving order:",e),!1}}async function x(e){return(await h()).find(t=>t.id===e)||null}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[276,779,59],()=>r(7758));module.exports=n})();