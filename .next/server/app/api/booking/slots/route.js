(()=>{var e={};e.id=418,e.ids=[418],e.modules={20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},78893:e=>{"use strict";e.exports=require("buffer")},84770:e=>{"use strict";e.exports=require("crypto")},80665:e=>{"use strict";e.exports=require("dns")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},98216:e=>{"use strict";e.exports=require("net")},55315:e=>{"use strict";e.exports=require("path")},76162:e=>{"use strict";e.exports=require("stream")},74026:e=>{"use strict";e.exports=require("string_decoder")},82452:e=>{"use strict";e.exports=require("tls")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},87529:()=>{},47758:(e,t,r)=>{"use strict";r.r(t),r.d(t,{originalPathname:()=>g,patchFetch:()=>h,requestAsyncStorage:()=>d,routeModule:()=>p,serverHooks:()=>m,staticGenerationAsyncStorage:()=>f});var s={};r.r(s),r.d(s,{GET:()=>c});var n=r(49303),i=r(88716),a=r(60670),o=r(87070),u=r(66299),l=r(58867);async function c(e){try{let{searchParams:t}=new URL(e.url),r=t.get("date"),s=t.get("serviceId");if(!r||!s)return o.NextResponse.json({error:"Faltan par\xe1metros"},{status:400});let n=await (0,u.QN)();if(!n.booking?.enabled)return o.NextResponse.json({error:"Las reservas no est\xe1n habilitadas"},{status:400});let i=n.services.find(e=>e.id===s);if(!i)return o.NextResponse.json({error:"Servicio no encontrado"},{status:400});let a=i.durationMinutes||60,c=new Date(r+"T12:00:00").getDay(),p=n.booking.recurring?.find(e=>e.dayOfWeek===c);if(!p||0===p.slots.length)return o.NextResponse.json({slots:[],message:"No hay atenci\xf3n este d\xeda"});let d=n.booking.exceptions?.find(e=>e.date===r),f=[];if(d){if(d.isBlocked)return o.NextResponse.json({slots:[],message:"Esta fecha est\xe1 bloqueada"});f=function(e,t){if(0===t.length)return e;let r=Array(48).fill(!1);for(let t of e){let e=(0,l.TD)(t.start)/30,s=(0,l.TD)(t.end)/30;for(let t=e;t<s&&t<48;t++)r[t]=!0}for(let e of t){let t=(0,l.TD)(e.start)/30,s=(0,l.TD)(e.end)/30;for(let e=t;e<s&&e<48;e++)r[e]=!1}let s=[],n=null;for(let e=0;e<=48;e++)r[e]&&null===n?n=e:r[e]||null===n||(s.push({start:(0,l.mr)(30*n),end:(0,l.mr)(30*e)}),n=null);return s}(p.slots,d.slots)}else f=p.slots;let m=new Date;m.setHours(0,0,0,0);let g=new Date(r+"T00:00:00");if(g<m)return o.NextResponse.json({slots:[],message:"No se pueden reservar fechas pasadas"});let h=(await (0,u.pF)(r)).map(e=>({start:(0,l.TD)(e.time),end:(0,l.TD)(e.endTime||e.time)||(0,l.TD)(e.time)+60})),x=[];for(let e of f){let t=(0,l.TD)(e.start),r=(0,l.TD)(e.end),s=t;for(;s+a<=r;){let e=s+a;if(!h.some(t=>s>=t.start&&s<t.end||e>t.start&&e<=t.end||s<=t.start&&e>=t.end)){if(g.toDateString()===m.toDateString()){let e=new Date,t=60*e.getHours()+e.getMinutes();s>t+60&&x.push((0,l.mr)(s))}else x.push((0,l.mr)(s))}s+=30}}return o.NextResponse.json({slots:x,service:{id:i.id,name:i.name,price:i.price,duration:a}})}catch(e){return console.error("Error getting slots:",e),o.NextResponse.json({error:"Error al obtener disponibilidad"},{status:500})}}let p=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/booking/slots/route",pathname:"/api/booking/slots",filename:"route",bundlePath:"app/api/booking/slots/route"},resolvedPagePath:"C:\\Users\\agusk\\Desktop\\Stuff\\Projects\\PilatesReformer\\src\\app\\api\\booking\\slots\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:d,staticGenerationAsyncStorage:f,serverHooks:m}=p,g="/api/booking/slots/route";function h(){return(0,a.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:f})}},58867:(e,t,r)=>{"use strict";r.d(t,{T4:()=>n,TD:()=>i,mH:()=>o,mr:()=>a,u_:()=>s});let s={site:{siteName:"Corpe Pilates",tagline:"Pilates Reformer para todos",instagram:"https://instagram.com/corpepilates",whatsapp:"5491161515110",email:"corpepilates@gmail.com",location:"Avenida Segurola 386, Floresta, CABA",deliveryMode:"pickup",productsEnabled:!1},booking:{enabled:!0,recurring:[{dayOfWeek:2,slots:[{start:"18:00",end:"19:00"}]},{dayOfWeek:5,slots:[{start:"18:00",end:"19:00"}]}],exceptions:[]},products:[],services:[{id:"plan-1x",name:"Plan 1x Semana",description:"4 clases mensuales de Pilates Reformer. Ideal para iniciarte en la pr\xe1ctica y trabajar tu core, postura y fuerza general.",price:25e3,duration:"60 min",durationMinutes:60,image:"https://images.unsplash.com/photo-1518611012118-696072aa579a?w=400&h=400&fit=crop"},{id:"plan-2x",name:"Plan 2x Semana",description:"8 clases mensuales de Pilates Reformer. Perfecto para progresar m\xe1s r\xe1pido y sentir resultados en pocas semanas.",price:4e4,duration:"60 min",durationMinutes:60,image:"https://images.unsplash.com/photo-1571019614242-c5c5dee9f50b?w=400&h=400&fit=crop"},{id:"plan-3x",name:"Plan 3x Semana",description:"12 clases mensuales de Pilates Reformer. M\xe1ximos resultados: mayor fuerza, flexibilidad y cuidado de tu columna.",price:55e3,duration:"60 min",durationMinutes:60,image:"https://images.unsplash.com/photo-1599901860904-17e6ed7083a0?w=400&h=400&fit=crop"}]};function n(e){return new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS",minimumFractionDigits:0,maximumFractionDigits:0}).format(e)}function i(e){let[t,r]=e.split(":").map(Number);return 60*t+r}function a(e){return`${Math.floor(e/60).toString().padStart(2,"0")}:${(e%60).toString().padStart(2,"0")}`}function o(e,t){return a(i(e)+t)}},79534:(e,t,r)=>{"use strict";r.d(t,{Q:()=>a});var s=r(62197),n=r.n(s);let i=null;function a(){if(!i){let e=process.env.REDIS_URL;if(!e)throw Error("Missing REDIS_URL environment variable");i=new(n())(e)}return i}},66299:(e,t,r)=>{"use strict";r.d(t,{AU:()=>m,HG:()=>h,IF:()=>c,Oh:()=>l,QN:()=>u,Qv:()=>f,TR:()=>g,iD:()=>p,pF:()=>d});var s=r(58867),n=r(79534);let i="corpepilates:config",a="corpepilates:reservations",o="corpepilates:orders";async function u(){try{let e=(0,n.Q)(),t=await e.get(i);if(t)return JSON.parse(t);return s.u_}catch(e){return console.error("Error getting config:",e),s.u_}}async function l(e){try{let t=(0,n.Q)();return await t.set(i,JSON.stringify(e)),!0}catch(e){return console.error("Error saving config:",e),!1}}async function c(){try{let e=(0,n.Q)(),t=await e.get(a);if(t)return JSON.parse(t);return[]}catch{return[]}}async function p(e){try{let t=(0,n.Q)(),r=await c(),s=r.findIndex(t=>t.id===e.id);return s>=0?r[s]=e:r.push(e),await t.set(a,JSON.stringify(r)),!0}catch(e){return console.error("Error saving reservation:",e),!1}}async function d(e){return(await c()).filter(t=>t.date===e&&"cancelled"!==t.status)}async function f(e){return(await c()).find(t=>t.id===e)||null}async function m(){try{let e=(0,n.Q)(),t=await e.get(o);if(t)return JSON.parse(t);return[]}catch{return[]}}async function g(e){try{let t=(0,n.Q)(),r=await m(),s=r.findIndex(t=>t.id===e.id);return s>=0?r[s]=e:r.push(e),await t.set(o,JSON.stringify(r)),!0}catch(e){return console.error("Error saving order:",e),!1}}async function h(e){return(await m()).find(t=>t.id===e)||null}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[276,197,59],()=>r(47758));module.exports=s})();