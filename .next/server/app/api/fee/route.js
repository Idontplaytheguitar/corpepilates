"use strict";(()=>{var e={};e.id=378,e.ids=[378],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},1282:e=>{e.exports=require("child_process")},4770:e=>{e.exports=require("crypto")},665:e=>{e.exports=require("dns")},7702:e=>{e.exports=require("events")},2048:e=>{e.exports=require("fs")},2615:e=>{e.exports=require("http")},8791:e=>{e.exports=require("https")},8216:e=>{e.exports=require("net")},9801:e=>{e.exports=require("os")},5315:e=>{e.exports=require("path")},6162:e=>{e.exports=require("stream")},2452:e=>{e.exports=require("tls")},7360:e=>{e.exports=require("url")},1764:e=>{e.exports=require("util")},1568:e=>{e.exports=require("zlib")},6005:e=>{e.exports=require("node:crypto")},2070:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>g,patchFetch:()=>v,requestAsyncStorage:()=>f,routeModule:()=>d,serverHooks:()=>y,staticGenerationAsyncStorage:()=>x});var n={};r.r(n),r.d(n,{GET:()=>p,POST:()=>l});var a=r(9303),s=r(8716),o=r(670),i=r(7070),c=r(5579),u=r(5456);async function p(){let e=await (0,c.eA)();return i.NextResponse.json(e)}async function l(e){let t=e.cookies.get("corpepilates_session")?.value;if(!(t&&await (0,u.X7)(t)))return i.NextResponse.json({error:"No autorizado"},{status:401});try{let{enabled:t,percentage:r,developmentPaid:n}=await e.json();"boolean"==typeof n&&await (0,c._d)(n),"boolean"==typeof t&&await (0,c.Bu)(t),"number"==typeof r&&await (0,c.Wc)(r);let a=await (0,c.eA)();return i.NextResponse.json({success:!0,...a})}catch{return i.NextResponse.json({error:"Error al actualizar"},{status:500})}}let d=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/fee/route",pathname:"/api/fee",filename:"route",bundlePath:"app/api/fee/route"},resolvedPagePath:"C:\\Users\\agusk\\Desktop\\Stuff\\Projects\\PilatesReformer\\src\\app\\api\\fee\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:f,staticGenerationAsyncStorage:x,serverHooks:y}=d,g="/api/fee/route";function v(){return(0,o.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:x})}},5456:(e,t,r)=>{r.d(t,{Bx:()=>g,Gv:()=>f,P:()=>x,P0:()=>l,TQ:()=>m,X7:()=>h,a2:()=>w,kt:()=>v,qD:()=>y,sp:()=>d});var n=r(8779),a=r(5245),s=r(4770),o=r.n(s);let i="corpepilates:admin_password",c="corpepilates:otp",u="corpepilates:session:";function p(){return(0,n.eI)({url:process.env.KV_REST_API_URL,token:process.env.KV_REST_API_TOKEN,cache:"no-store",automaticDeserialization:!0})}async function l(){try{return await p().get(i)}catch{return null}}async function d(e){try{return await p().set(i,e),!0}catch{return!1}}async function f(e){if(e===(process.env.ADMIN_PASSWORD||"corpepilates2024"))return!0;let t=await l();return!!t&&e===t}async function x(){let e=Math.random().toString().slice(2,8);return await p().set(c,e,{ex:600}),e}async function y(e,t=!1){try{let r=await p().get(c),n=String(r||""),a=String(e||"").trim();if(n&&n===a)return t&&await p().del(c),!0;return!1}catch(e){return console.error("Error verificando OTP:",e),!1}}async function g(){try{await p().del(c)}catch{}}async function v(){let e=o().randomBytes(32).toString("hex");return await p().set(u+e,{createdAt:Date.now()},{ex:432e3}),e}async function h(e){if(!e)return!1;try{return!!await p().get(u+e)}catch{return!1}}async function m(e){try{await p().del(u+e)}catch{}}async function w(e,t){let r=process.env.SMTP_USER,n=process.env.SMTP_PASS,s=process.env.SMTP_HOST||"smtp.gmail.com",o=parseInt(process.env.SMTP_PORT||"465");if(!r||!n)return{success:!1,error:"Email no configurado en el servidor"};try{let i=a.createTransport({host:s,port:o,secure:465===o,auth:{user:r,pass:n}});return await i.sendMail({from:`Corpe Pilates <${r}>`,to:e,subject:"C\xf3digo de verificaci\xf3n - Corpe Pilates Admin",html:`
        <div style="font-family: sans-serif; max-width: 400px; margin: 0 auto; padding: 20px;">
          <h2 style="color: #e85d5d; text-align: center;">Corpe Pilates</h2>
          <p style="text-align: center; color: #666;">Tu c\xf3digo de verificaci\xf3n es:</p>
          <div style="background: #f5f5f5; padding: 20px; text-align: center; border-radius: 10px; margin: 20px 0;">
            <span style="font-size: 32px; font-weight: bold; letter-spacing: 5px; color: #333;">${t}</span>
          </div>
          <p style="text-align: center; color: #999; font-size: 12px;">
            Este c\xf3digo expira en 10 minutos.<br>
            Si no solicitaste este c\xf3digo, ignor\xe1 este email.
          </p>
        </div>
      `}),{success:!0}}catch(e){return console.error("Error sending OTP email:",e),{success:!1,error:e instanceof Error?e.message:"Error desconocido"}}}},5579:(e,t,r)=>{r.d(t,{Bu:()=>l,Wc:()=>d,_d:()=>c,eA:()=>f});var n=r(8779);let a="corpepilates:fee_enabled",s="corpepilates:fee_percentage",o="corpepilates:development_paid";async function i(){try{let e=await n.kv.get(o);return!0===e}catch{return!1}}async function c(e){try{return await n.kv.set(o,e),e&&await n.kv.set(a,!1),!0}catch{return!1}}async function u(){try{if(await i())return!1;let e=await n.kv.get(a);return!1!==e}catch{return!0}}async function p(){try{return await n.kv.get(s)??5}catch{return 5}}async function l(e){try{return await n.kv.set(a,e),!0}catch{return!1}}async function d(e){try{return await n.kv.set(s,e),!0}catch{return!1}}async function f(){let[e,t,r]=await Promise.all([u(),p(),i()]);return{enabled:e,percentage:t,developmentPaid:r}}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[276,779,59,245],()=>r(2070));module.exports=n})();