"use strict";(()=>{var e={};e.id=0,e.ids=[0],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},1282:e=>{e.exports=require("child_process")},4770:e=>{e.exports=require("crypto")},665:e=>{e.exports=require("dns")},7702:e=>{e.exports=require("events")},2048:e=>{e.exports=require("fs")},2615:e=>{e.exports=require("http")},8791:e=>{e.exports=require("https")},8216:e=>{e.exports=require("net")},9801:e=>{e.exports=require("os")},5315:e=>{e.exports=require("path")},6162:e=>{e.exports=require("stream")},2452:e=>{e.exports=require("tls")},7360:e=>{e.exports=require("url")},1764:e=>{e.exports=require("util")},1568:e=>{e.exports=require("zlib")},6005:e=>{e.exports=require("node:crypto")},7755:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>x,patchFetch:()=>h,requestAsyncStorage:()=>m,routeModule:()=>d,serverHooks:()=>g,staticGenerationAsyncStorage:()=>f});var a={};t.r(a),t.d(a,{POST:()=>l});var o=t(9303),i=t(8716),n=t(670),s=t(7070),p=t(6299),c=t(471),u=t(8867);async function l(e){try{let{items:r,serviceItems:t,selectedSlots:a,customer:o,total:i}=await e.json();if(!o?.name||!o?.email)return s.NextResponse.json({error:"Datos del cliente incompletos"},{status:400});let n=await (0,p.QN)(),l=n.site?.siteName||"Corpe Pilates",d=`order_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,m={id:d,items:r||[],serviceItems:t||[],selectedSlots:a||[],customer:o,total:i,status:"confirmed",deliveryStatus:r&&r.length>0?"pending":void 0,createdAt:Date.now()};await (0,p.TR)(m);let f="";r&&r.length>0&&(f+='<h4 style="margin: 15px 0 10px;">Productos:</h4><ul>',r.forEach(e=>{f+=`<li>${e.name} x${e.quantity} - ${(0,u.T4)(e.price*e.quantity)}</li>`}),f+="</ul>"),t&&t.length>0&&(f+='<h4 style="margin: 15px 0 10px;">Servicios:</h4><ul>',t.forEach(e=>{f+=`<li>${e.name} x${e.quantity} - ${(0,u.T4)(e.price*e.quantity)}</li>`}),f+="</ul>"),a&&a.length>0&&(f+='<h4 style="margin: 15px 0 10px;">Turnos reservados:</h4><ul>',a.forEach(e=>{let r=new Date(e.date+"T12:00:00").toLocaleDateString("es-AR",{weekday:"long",day:"numeric",month:"long"});f+=`<li>üìÖ ${r} a las ${e.time}</li>`}),f+="</ul>");let g=`
      <div style="font-family: sans-serif; max-width: 600px; margin: 0 auto;">
        <h2 style="color: #be185d;">üéâ Nueva Compra</h2>
        <div style="background: #fdf2f8; padding: 20px; border-radius: 12px; margin: 20px 0;">
          ${f}
          <p style="font-size: 18px; font-weight: bold; margin-top: 15px;">Total: ${(0,u.T4)(i)}</p>
        </div>
        <div style="background: #f1f5f9; padding: 20px; border-radius: 12px;">
          <h4 style="margin-top: 0;">Datos del cliente:</h4>
          <p><strong>üë§ Nombre:</strong> ${o.name}</p>
          <p><strong>üìß Email:</strong> ${o.email}</p>
          <p><strong>üì± Tel\xe9fono:</strong> ${o.phone}</p>
        </div>
      </div>
    `,x=n.site.location?`<div style="background: #f0fdf4; padding: 15px; border-radius: 12px; margin: 20px 0;">
          <p style="margin: 0; color: #166534;"><strong>üìç Ubicaci\xf3n:</strong> ${n.site.location}</p>
        </div>`:"",h=`
      <div style="font-family: sans-serif; max-width: 600px; margin: 0 auto;">
        <h2 style="color: #be185d;">‚úÖ \xa1Gracias por tu compra!</h2>
        <p>\xa1Hola ${o.name}!</p>
        <p>Tu pago fue procesado exitosamente. Ac\xe1 est\xe1 el detalle:</p>
        <div style="background: #fdf2f8; padding: 20px; border-radius: 12px; margin: 20px 0;">
          ${f}
          <p style="font-size: 18px; font-weight: bold; margin-top: 15px;">Total: ${(0,u.T4)(i)}</p>
        </div>
        ${x}
        <p style="color: #64748b; font-size: 14px;">
          Si ten\xe9s alguna consulta, escribinos por WhatsApp al ${n.site.whatsapp||"nuestro n\xfamero de contacto"}.
        </p>
        <p style="margin-top: 30px;">\xa1Gracias por tu confianza! üíï</p>
        <p><strong>${l}</strong></p>
      </div>
    `;return n.site.email&&await (0,c.C)(n.site.email,`Nueva compra - ${(0,u.T4)(i)}`,g),await (0,c.C)(o.email,`\xa1Gracias por tu compra! - ${l}`,h),s.NextResponse.json({success:!0,orderId:d})}catch(e){return console.error("Error processing order notification:",e),s.NextResponse.json({error:"Error al procesar la notificaci\xf3n"},{status:500})}}let d=new o.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/order/notify/route",pathname:"/api/order/notify",filename:"route",bundlePath:"app/api/order/notify/route"},resolvedPagePath:"C:\\Users\\agusk\\Desktop\\Stuff\\Projects\\PilatesReformer\\src\\app\\api\\order\\notify\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:m,staticGenerationAsyncStorage:f,serverHooks:g}=d,x="/api/order/notify/route";function h(){return(0,n.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:f})}},8867:(e,r,t)=>{t.d(r,{T4:()=>o,TD:()=>i,mH:()=>s,mr:()=>n,u_:()=>a});let a={site:{siteName:"Corpe Pilates",tagline:"Pilates Reformer para todos",instagram:"https://instagram.com/corpepilates",whatsapp:"5491161515110",email:"corpepilates@gmail.com",location:"Avenida Segurola 386, Floresta, CABA",deliveryMode:"pickup"},booking:{enabled:!0,recurring:[{dayOfWeek:2,slots:[{start:"18:00",end:"19:00"}]},{dayOfWeek:5,slots:[{start:"18:00",end:"19:00"}]}],exceptions:[]},products:[],services:[{id:"plan-1x",name:"Plan 1x Semana",description:"4 clases mensuales de Pilates Reformer. Ideal para iniciarte en la pr\xe1ctica y trabajar tu core, postura y fuerza general.",price:25e3,duration:"60 min",durationMinutes:60,image:"https://images.unsplash.com/photo-1518611012118-696072aa579a?w=400&h=400&fit=crop"},{id:"plan-2x",name:"Plan 2x Semana",description:"8 clases mensuales de Pilates Reformer. Perfecto para progresar m\xe1s r\xe1pido y sentir resultados en pocas semanas.",price:4e4,duration:"60 min",durationMinutes:60,image:"https://images.unsplash.com/photo-1571019614242-c5c5dee9f50b?w=400&h=400&fit=crop"},{id:"plan-3x",name:"Plan 3x Semana",description:"12 clases mensuales de Pilates Reformer. M\xe1ximos resultados: mayor fuerza, flexibilidad y cuidado de tu columna.",price:55e3,duration:"60 min",durationMinutes:60,image:"https://images.unsplash.com/photo-1599901860904-17e6ed7083a0?w=400&h=400&fit=crop"}]};function o(e){return new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS",minimumFractionDigits:0,maximumFractionDigits:0}).format(e)}function i(e){let[r,t]=e.split(":").map(Number);return 60*r+t}function n(e){return`${Math.floor(e/60).toString().padStart(2,"0")}:${(e%60).toString().padStart(2,"0")}`}function s(e,r){return n(i(e)+r)}},471:(e,r,t)=>{t.d(r,{C:()=>i});var a=t(5245),o=t(6299);async function i(e,r,t){let i=process.env.SMTP_USER,n=process.env.SMTP_PASS,s=process.env.SMTP_HOST||"smtp.gmail.com",p=parseInt(process.env.SMTP_PORT||"465");if(!i||!n)return console.log("SMTP not configured, skipping email to:",e),{success:!1,error:"Email no configurado en el servidor"};try{let c=await (0,o.QN)(),u=c.site?.siteName||"Corpe Pilates",l=a.createTransport({host:s,port:p,secure:465===p,auth:{user:i,pass:n}});return await l.sendMail({from:`${u} <${i}>`,to:e,subject:r,html:t}),{success:!0}}catch(e){return console.error("Error sending email:",e),{success:!1,error:e instanceof Error?e.message:"Error desconocido"}}}},6299:(e,r,t)=>{t.d(r,{AU:()=>x,HG:()=>y,IF:()=>d,Oh:()=>l,QN:()=>u,Qv:()=>g,TR:()=>h,iD:()=>m,pF:()=>f});var a=t(8867),o=t(8779);let i="corpepilates:config",n="corpepilates:reservations",s="corpepilates:orders",p=null;function c(){if(p)return p;let e=process.env.KV_REST_API_URL,r=process.env.KV_REST_API_TOKEN;if(!e||!r)throw Error("Missing KV_REST_API_URL / KV_REST_API_TOKEN");return p=(0,o.eI)({url:e,token:r,cache:"no-store"})}async function u(){try{return await c().get(i)||a.u_}catch(e){return a.u_}}async function l(e){try{return await c().set(i,e),!0}catch(e){return console.error("Error saving config:",e),!1}}async function d(){try{return await c().get(n)||[]}catch{return[]}}async function m(e){try{let r=await d(),t=r.findIndex(r=>r.id===e.id);return t>=0?r[t]=e:r.push(e),await c().set(n,r),!0}catch(e){return console.error("Error saving reservation:",e),!1}}async function f(e){return(await d()).filter(r=>r.date===e&&"cancelled"!==r.status)}async function g(e){return(await d()).find(r=>r.id===e)||null}async function x(){try{return await c().get(s)||[]}catch{return[]}}async function h(e){try{let r=await x(),t=r.findIndex(r=>r.id===e.id);return t>=0?r[t]=e:r.push(e),await c().set(s,r),!0}catch(e){return console.error("Error saving order:",e),!1}}async function y(e){return(await x()).find(r=>r.id===e)||null}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[276,779,59,245],()=>t(7755));module.exports=a})();