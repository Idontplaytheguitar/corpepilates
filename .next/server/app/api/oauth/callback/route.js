(()=>{var e={};e.id=262,e.ids=[262],e.modules={20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},78893:e=>{"use strict";e.exports=require("buffer")},84770:e=>{"use strict";e.exports=require("crypto")},80665:e=>{"use strict";e.exports=require("dns")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},98216:e=>{"use strict";e.exports=require("net")},55315:e=>{"use strict";e.exports=require("path")},76162:e=>{"use strict";e.exports=require("stream")},74026:e=>{"use strict";e.exports=require("string_decoder")},82452:e=>{"use strict";e.exports=require("tls")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},87529:()=>{},92950:(e,r,t)=>{"use strict";t.r(r),t.d(r,{originalPathname:()=>f,patchFetch:()=>x,requestAsyncStorage:()=>p,routeModule:()=>l,serverHooks:()=>h,staticGenerationAsyncStorage:()=>d});var s={};t.r(s),t.d(s,{GET:()=>u});var n=t(49303),a=t(88716),o=t(60670),i=t(87070),c=t(90214);async function u(e){let r=e.nextUrl.searchParams,t=r.get("code"),s=r.get("error"),n="https://corpepilates.vercel.app/";if(s)return i.NextResponse.redirect(`${n}/admin?oauth=error&message=${s}`);if(!t)return i.NextResponse.redirect(`${n}/admin?oauth=error&message=no_code`);try{let e=await fetch("https://api.mercadopago.com/oauth/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({grant_type:"authorization_code",client_id:process.env.CLIENT_ID||"",client_secret:process.env.CLIENT_SECRET||"",code:t,redirect_uri:`${n}/api/oauth/callback`})});if(!e.ok){let r=await e.json();return console.error("OAuth token error:",r),i.NextResponse.redirect(`${n}/admin?oauth=error&message=token_error`)}let r=await e.json(),s={accessToken:r.access_token,refreshToken:r.refresh_token,userId:r.user_id.toString(),publicKey:r.public_key,expiresAt:Date.now()+1e3*r.expires_in,connectedAt:Date.now(),feeEnabled:!0,feePercentage:5};return await (0,c.Db)(s),i.NextResponse.redirect(`${n}/admin?oauth=success`)}catch(e){return console.error("OAuth callback error:",e),i.NextResponse.redirect(`${n}/admin?oauth=error&message=unknown`)}}let l=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/oauth/callback/route",pathname:"/api/oauth/callback",filename:"route",bundlePath:"app/api/oauth/callback/route"},resolvedPagePath:"C:\\Users\\agusk\\Desktop\\Stuff\\Projects\\PilatesReformer\\src\\app\\api\\oauth\\callback\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:p,staticGenerationAsyncStorage:d,serverHooks:h}=l,f="/api/oauth/callback/route";function x(){return(0,o.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:d})}},90214:(e,r,t)=>{"use strict";t.d(r,{Bv:()=>l,Db:()=>o,VX:()=>a,ih:()=>c,lP:()=>i});var s=t(79534);let n="corpepilates:seller";async function a(){try{let e=(0,s.Q)(),r=await e.get(n);if(r)return JSON.parse(r);return null}catch{return null}}async function o(e){try{let r=(0,s.Q)();return await r.set(n,JSON.stringify(e)),!0}catch(e){return console.error("Error saving seller credentials:",e),!1}}async function i(e,r=5){try{let t=await a();if(!t)return!1;t.feeEnabled=e,t.feePercentage=r;let o=(0,s.Q)();return await o.set(n,JSON.stringify(t)),!0}catch{return!1}}async function c(){try{let e=(0,s.Q)();return await e.del(n),!0}catch{return!1}}async function u(e){try{let r=await fetch("https://api.mercadopago.com/oauth/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({grant_type:"refresh_token",client_id:process.env.CLIENT_ID||"",client_secret:process.env.CLIENT_SECRET||"",refresh_token:e})});if(!r.ok)return null;let t=await r.json(),s={accessToken:t.access_token,refreshToken:t.refresh_token,userId:t.user_id.toString(),publicKey:t.public_key,expiresAt:Date.now()+1e3*t.expires_in,connectedAt:Date.now(),feeEnabled:!0,feePercentage:5};return await o(s),s}catch{return null}}async function l(){let e=await a();if(!e)return null;if(Date.now()>e.expiresAt-6e4){let r=await u(e.refreshToken);return r?.accessToken||null}return e.accessToken}},79534:(e,r,t)=>{"use strict";t.d(r,{Q:()=>o});var s=t(62197),n=t.n(s);let a=null;function o(){if(!a){let e=process.env.REDIS_URL;if(!e)throw Error("Missing REDIS_URL environment variable");a=new(n())(e)}return a}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[276,197,59],()=>t(92950));module.exports=s})();