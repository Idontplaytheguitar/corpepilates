(()=>{var e={};e.id=607,e.ids=[607],e.modules={20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},78893:e=>{"use strict";e.exports=require("buffer")},84770:e=>{"use strict";e.exports=require("crypto")},80665:e=>{"use strict";e.exports=require("dns")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},35240:e=>{"use strict";e.exports=require("https")},98216:e=>{"use strict";e.exports=require("net")},55315:e=>{"use strict";e.exports=require("path")},68621:e=>{"use strict";e.exports=require("punycode")},76162:e=>{"use strict";e.exports=require("stream")},74026:e=>{"use strict";e.exports=require("string_decoder")},82452:e=>{"use strict";e.exports=require("tls")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},87529:()=>{},45730:(e,t,r)=>{"use strict";r.r(t),r.d(t,{originalPathname:()=>m,patchFetch:()=>w,requestAsyncStorage:()=>f,routeModule:()=>d,serverHooks:()=>h,staticGenerationAsyncStorage:()=>y});var n={};r.r(n),r.d(n,{POST:()=>l});var s=r(49303),i=r(88716),a=r(60670),c=r(87070),u=r(36994),o=r(90214),p=r(95579);async function l(e){try{let{items:t=[],serviceItems:r=[],customer:n}=await e.json();if(0===t.length&&0===r.length)return c.NextResponse.json({error:"No hay productos ni servicios en el carrito"},{status:400});let s=await (0,o.VX)()?await (0,o.Bv)():null;if(!s)return c.NextResponse.json({error:"No hay cuenta de MercadoPago conectada. Contacta al vendedor."},{status:400});let i=new u.f7({accessToken:s}),a=function(){let e="https://corpepilates.vercel.app/";return e.endsWith("/")?e.slice(0,-1):e}(),l=new u.Jk(i),d=t.reduce((e,t)=>{let r=t.product?.price??t.price??0;return e+r*t.quantity},0),f=r.reduce((e,t)=>e+t.price*t.quantity,0),y=await (0,p.eA)(),h=y.enabled?Math.round(y.percentage/100*(d+f)):0,m=[...t.map(e=>({id:e.product?.id??e.id??"product",title:e.product?.name??e.name??"Producto",quantity:e.quantity,unit_price:e.product?.price??e.price??0,currency_id:"ARS",picture_url:e.product?.image??e.image})),...r.map(e=>({id:e.id,title:e.name,quantity:e.quantity,unit_price:e.price,currency_id:"ARS",picture_url:e.image}))],w=JSON.stringify({orderId:`order_${Date.now()}`,serviceItems:r.map(e=>({id:e.id,name:e.name,slots:e.selectedSlots||[]})),customer:n}),g=await l.create({body:{items:m,payer:{name:n.name,email:n.email,phone:{number:n.phone}},back_urls:{success:`${a}/success`,failure:`${a}/failure`,pending:`${a}/pending`},auto_return:"approved",statement_descriptor:"CORPEPILATES",external_reference:w,...h>0&&{marketplace_fee:h}}});return c.NextResponse.json({id:g.id,init_point:g.init_point})}catch(e){return console.error("Error creating preference:",e),c.NextResponse.json({error:"Error al crear la preferencia de pago"},{status:500})}}let d=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/checkout/route",pathname:"/api/checkout",filename:"route",bundlePath:"app/api/checkout/route"},resolvedPagePath:"C:\\Users\\agusk\\Desktop\\Stuff\\Projects\\PilatesReformer\\src\\app\\api\\checkout\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:f,staticGenerationAsyncStorage:y,serverHooks:h}=d,m="/api/checkout/route";function w(){return(0,a.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:y})}},95579:(e,t,r)=>{"use strict";r.d(t,{Bu:()=>l,Wc:()=>d,_d:()=>u,eA:()=>f});var n=r(79534);let s="corpepilates:fee_enabled",i="corpepilates:fee_percentage",a="corpepilates:development_paid";async function c(){try{let e=(0,n.Q)(),t=await e.get(a);return"true"===t}catch{return!1}}async function u(e){try{let t=(0,n.Q)();return await t.set(a,e?"true":"false"),e&&await t.set(s,"false"),!0}catch{return!1}}async function o(){try{if(await c())return!1;let e=(0,n.Q)(),t=await e.get(s);return"false"!==t}catch{return!0}}async function p(){try{let e=(0,n.Q)(),t=await e.get(i);return t?parseInt(t):5}catch{return 5}}async function l(e){try{let t=(0,n.Q)();return await t.set(s,e?"true":"false"),!0}catch{return!1}}async function d(e){try{let t=(0,n.Q)();return await t.set(i,e.toString()),!0}catch{return!1}}async function f(){let[e,t,r]=await Promise.all([o(),p(),c()]);return{enabled:e,percentage:t,developmentPaid:r}}},90214:(e,t,r)=>{"use strict";r.d(t,{Bv:()=>p,Db:()=>a,VX:()=>i,ih:()=>u,lP:()=>c});var n=r(79534);let s="corpepilates:seller";async function i(){try{let e=(0,n.Q)(),t=await e.get(s);if(t)return JSON.parse(t);return null}catch{return null}}async function a(e){try{let t=(0,n.Q)();return await t.set(s,JSON.stringify(e)),!0}catch(e){return console.error("Error saving seller credentials:",e),!1}}async function c(e,t=5){try{let r=await i();if(!r)return!1;r.feeEnabled=e,r.feePercentage=t;let a=(0,n.Q)();return await a.set(s,JSON.stringify(r)),!0}catch{return!1}}async function u(){try{let e=(0,n.Q)();return await e.del(s),!0}catch{return!1}}async function o(e){try{let t=await fetch("https://api.mercadopago.com/oauth/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({grant_type:"refresh_token",client_id:process.env.CLIENT_ID||"",client_secret:process.env.CLIENT_SECRET||"",refresh_token:e})});if(!t.ok)return null;let r=await t.json(),n={accessToken:r.access_token,refreshToken:r.refresh_token,userId:r.user_id.toString(),publicKey:r.public_key,expiresAt:Date.now()+1e3*r.expires_in,connectedAt:Date.now(),feeEnabled:!0,feePercentage:5};return await a(n),n}catch{return null}}async function p(){let e=await i();if(!e)return null;if(Date.now()>e.expiresAt-6e4){let t=await o(e.refreshToken);return t?.accessToken||null}return e.accessToken}},79534:(e,t,r)=>{"use strict";r.d(t,{Q:()=>a});var n=r(62197),s=r.n(n);let i=null;function a(){if(!i){let e=process.env.REDIS_URL;if(!e)throw Error("Missing REDIS_URL environment variable");i=new(s())(e)}return i}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[276,197,59,994],()=>r(45730));module.exports=n})();